# 办公文件预览修改说明

## 修改背景

原项目中办公文件（Word、Excel、PowerPoint等）的预览功能存在以下问题：
1. 依赖复杂的 Qt WebEngine 和 PDF 转换
2. 需要 LibreOffice 后台支持
3. 转换过程可能出现失败或延迟
4. 用户体验不佳

## 修改方案

将办公文件的预览方式从复杂的文档解析改为**常规文件夹显示模式**，即显示文件的详细信息而不是内容预览。

## 具体修改

### 1. 核心逻辑修改

在 `src/MainWindow.cpp` 的 `onItemClicked` 函数中，将复杂的办公文件预览逻辑：

```cpp
// 原来的复杂逻辑
#ifdef HAVE_QT_WEBENGINE
    if (m_officeWebViewer && m_officeWebViewer->loadDocument(path)) {
        m_stack->setCurrentWidget(m_officeWebViewer);
        // ...
    }
#endif
#ifdef HAVE_QT_PDF_CORE
    // 后台转换逻辑...
#endif
```

修改为简单的文件详情显示：

```cpp
// 新的简化逻辑
if (isOfficeFile(path)) {
    showFileDetails(path);
    QFileInfo fileInfo(path);
    QString fileType = fileInfo.suffix().toUpper();
    statusBar()->showMessage(tr("办公文档 (%1): %2").arg(fileType, path));
    return;
}
```

### 2. 文件类型支持完善

扩展了 `showFileDetails` 函数中对办公文件的支持：

```cpp
// 文档图标支持
QStringList{"pdf", "doc", "docx", "txt", "md", "odt", "xls", "xlsx", "ppt", "pptx", "ods", "odp", "rtf"}

// 文档背景色支持
QStringList{"pdf", "doc", "docx", "txt", "md", "odt", "xls", "xlsx", "ppt", "pptx", "ods", "odp", "rtf"}
```

## 支持的办公文件格式

现在支持以下办公文件格式的详细信息显示：

- **Word文档**: `.doc`, `.docx`
- **Excel表格**: `.xls`, `.xlsx`
- **PowerPoint演示文稿**: `.ppt`, `.pptx`
- **OpenDocument格式**: `.odt`, `.ods`, `.odp`
- **其他**: `.pdf`, `.rtf`

## 显示效果

### 文件图标
- 使用文档图标 `:/icons/icons/documents.svg`
- 如果系统有对应文件类型的图标，则优先使用系统图标

### 背景颜色
- 浅色主题：黄色背景 (`#FCF3CF`)
- 深色主题：半透明背景 (`rgba(255, 255, 255, 0.05)`)

### 显示信息
显示完整的文件详细信息，包括：
- 文件名称
- 文件类型（如 "DOCX 文件"）
- 文件大小
- 修改时间
- 文件路径
- 权限信息

## 优势

1. **稳定性提升**：不再依赖外部工具和复杂转换
2. **响应速度**：即时显示，无延迟
3. **兼容性好**：支持所有办公文件格式
4. **用户体验**：一致的界面风格，简洁明了
5. **资源占用**：减少内存和CPU使用

## 保留的功能

- 其他文件类型（图片、文本、PDF、媒体文件）的预览功能保持不变
- 文件管理的基本功能完全保留
- 界面布局和交互方式不变

## 测试验证

项目已成功编译并通过测试，办公文件现在会按照常规文件夹方式显示详细信息。

---

**修改日期**: 2025-12-26  
**修改文件**: `src/MainWindow.cpp`  
**影响范围**: 办公文件预览功能